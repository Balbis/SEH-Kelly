{%- doc -%}
  Renders product badges for the product card.

  @param {object} product - The product object.
  @param {object} settings - The theme settings object.

  @example
  {% render 'product-card-badges', product: product, settings: settings %}
{%- enddoc -%}

{% liquid
  assign show_sold_out_badge = false
  assign show_sale_badge = false
  assign custom_badge = false

  if product.metafields.custom.product_badge != blank
    if product.metafields.custom.badge_expiry != blank
      assign badge_expiry = product.metafields.custom.badge_expiry.value | date: '%Y-%m-%d %H:%M:%S'
      assign current_time = 'now' | date: '%Y-%m-%d %H:%M:%S'
        assign custom_badge = true
        assign custom_badge_text = badge_expiry
    else
      assign custom_badge = true
      assign custom_badge_text = product.metafields.custom.product_badge.value
    endif
  endif

  if product.available == false
    assign show_sold_out_badge = true
  endif

  if product.compare_at_price > product.price and product.available
    assign show_sale_badge = true
  endif
%}

{% if custom_badge or show_sold_out_badge or show_sale_badge %}
  <div
    class="product-badges product-badges--{{ settings.badge_position }}"
    style="
      --badge-border-radius: {{ settings.badge_corner_radius }}px;
      --badge-font-family: var(--font-{{ settings.badge_font_family }}--family); --badge-font-weight: var(--font-{{ settings.badge_font_family }}--weight); --badge-text-transform: {{ settings.badge_text_transform }};
    "
  >
      <div
        class="
          product-badges__badge product-badges__badge--rectangle
          {% if show_sold_out_badge %} color-{{ settings.badge_sold_out_color_scheme }}{% else %} color-{{ settings.badge_sale_color_scheme }}{% endif %}
        "
      >
        {% if custom_badge %}
          {{ custom_badge_text }}
        {%- elsif show_sold_out_badge -%}
          {{ 'content.product_badge_sold_out' | t }}
        {%- elsif show_sale_badge -%}
          {{ 'content.product_badge_sale' | t }}
        {%- endif -%}
      </div>
  </div>
{% endif %}

{% stylesheet %}
  .product-badges {
    --badge-inset: max(var(--padding-xs), calc((var(--border-radius) + var(--padding-xs)) * (1 - cos(45deg))));

    position: absolute;
    z-index: var(--layer-flat);
  }

  .product-badges--bottom-left {
    bottom: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-left {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-right {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    right: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges__badge {
    --badge-font-size: var(--font-size--xs);

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--color-foreground);
    background: var(--color-background);
    font-size: var(--badge-font-size);
    font-family: var(--badge-font-family);
    font-weight: var(--badge-font-weight);
    text-transform: var(--badge-text-transform);
    border-radius: var(--badge-border-radius);
  }

  .product-badges__badge--rectangle {
    padding-block: var(--badge-rectangle-padding-block);
    padding-inline: var(--badge-rectangle-padding-inline);
  }
{% endstylesheet %}
